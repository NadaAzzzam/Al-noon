@let s = store();
@let hero = s?.hero;
@let collections = s?.homeCollections ?? [];
@let feedbacks = (s?.feedbackSectionEnabled ? (s?.feedbacks ?? []).slice(0, s?.feedbackDisplayLimit ?? 5) : []);

@if (error()) {
<section class="section">
  <div class="container">
    <p class="error-msg">{{ error() }}</p>
  </div>
</section>
}

@if (loading() && !s) {
<section class="section">
  <div class="container">
    <app-loading-skeleton type="card" [count]="4" />
  </div>
</section>
}

<!-- Hero -->
@if (s?.heroEnabled && hero) {
<section class="hero">
  @if (heroImages().length) {
  <div class="hero-media">
    <img [src]="api.imageUrl(heroImages()[heroImageIndex()])" [alt]="getLocalized(hero.title)" />
    @if (heroImages().length > 1) {
      <button type="button" class="hero-nav hero-prev" (click)="prevHeroImage()" aria-label="Previous slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button type="button" class="hero-nav hero-next" (click)="nextHeroImage()" aria-label="Next slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <div class="hero-dots">
        @for (img of heroImages(); track $index; let i = $index) {
          <button type="button" class="hero-dot" [class.active]="heroImageIndex() === i" (click)="heroImageIndex.set(i)" [attr.aria-label]="'Slide ' + (i + 1)"></button>
        }
      </div>
    }
  </div>
  }
  <div class="hero-content">
    <h1 class="hero-title">{{ getLocalized(hero.title) || ('home.newCollection' | translate) }}</h1>
    @if (getLocalized(hero.subtitle)) {
    <p class="hero-subtitle">{{ getLocalized(hero.subtitle) }}</p>
    }
    @if (hero.ctaUrl && getLocalized(hero.ctaLabel)) {
    <a [routerLink]="hero.ctaUrl" class="btn">{{ getLocalized(hero.ctaLabel) }}</a>
    }
  </div>
</section>
}

<!-- New Arrivals -->
<section class="section new-arrivals">
  <div class="container">
    <h2 class="section-title">{{ 'home.newArrivals' | translate }}</h2>
    @if (loading()) {
      <app-loading-skeleton type="card" [count]="4" />
    } @else if (newArrivals().length === 0) {
      <p class="empty-msg">{{ 'catalog.noProducts' | translate }}</p>
    } @else {
      <div class="product-grid">
        @for (p of newArrivals(); track p.id || $index) {
          <app-product-card [product]="p" />
        }
      </div>
    }
  </div>
</section>

<!-- Home collections (e.g. Abayas, Capes, Malhafa) -->
@if (collections.length) {
<section class="section collections-section">
  <div class="container">
    <h2 class="section-title">{{ 'home.collections' | translate }}</h2>
    <div class="collections-grid">
      @for (col of collections; track col.url || getLocalized(col.title)) {
      <a [routerLink]="col.url" class="collection-card">
        @if (col.image) {
        <img [src]="api.imageUrl(col.image)" [alt]="getLocalized(col.title)" loading="lazy" />
        }
        <div class="collection-card-content">
          <h3>{{ getLocalized(col.title) }}</h3>
        </div>
      </a>
      }
    </div>
  </div>
</section>
}

<!-- Our collection media (section images/videos) -->
@if (s?.ourCollectionSectionImages?.length || s?.ourCollectionSectionVideos?.length) {
<section class="section our-collection">
  <div class="container">
    <h2 class="section-title">{{ 'home.ourCollection' | translate }}</h2>
    <div class="media-grid">
      @for (img of s?.ourCollectionSectionImages ?? []; track img) {
      <div class="media-item">
        <img [src]="api.imageUrl(img)" alt="" loading="lazy" />
      </div>
      }
      @for (vid of s?.ourCollectionSectionVideos ?? []; track vid) {
      <div class="media-item">
        <video [src]="api.imageUrl(vid)" muted loop playsinline></video>
      </div>
      }
    </div>
  </div>
</section>
}

<!-- Testimonials / Feedback -->
@if (feedbacks.length) {
<section class="section testimonials">
  <div class="container">
    <h2 class="section-title">{{ 'home.testimonials' | translate }}</h2>
    <div class="testimonials-grid">
      @for (f of feedbacks; track f.id) {
      <blockquote class="testimonial-card">
        @if (f.rating) {
          <app-star-rating [rating]="f.rating" />
        }
        @if (f.comment) {
        <p>{{ f.comment }}</p>
        }
        @if (f.customerName) {
        <span class="testimonial-author">{{ f.customerName }}</span>
        }
        @if (f.product?.name) {
        <cite>{{ getLocalized(f.product?.name) }}</cite>
        }
      </blockquote>
      }
    </div>
  </div>
</section>
}
