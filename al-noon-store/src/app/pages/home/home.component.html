@let s = store();
@let hero = s?.hero;
@let collections = s?.homeCollections ?? [];
@let feedbacks = (s?.feedbackSectionEnabled ? (s?.feedbacks ?? []).slice(0, s?.feedbackDisplayLimit ?? 5) : []);

@if (error()) {
<section class="section">
  <div class="container">
    <p class="error-msg">{{ error() }}</p>
  </div>
</section>
}

@if (loading() && !s) {
<section class="section">
  <div class="container">
    <app-loading-skeleton type="card" [count]="4" />
  </div>
</section>
}

<!-- ═══════ Hero ═══════ -->
@if (s?.heroEnabled && hero) {
<section class="hero">
  @if (heroImages().length) {
  <div class="hero-media">
    @for (img of heroImages(); track img; let i = $index) {
      <img
        [src]="api.imageUrl(img)"
        [alt]="getLocalized(hero.title)"
        class="hero-img"
        [class.active]="heroImageIndex() === i"
        [class.prev]="heroImageIndex() !== i" />
    }
    @if (heroImages().length > 1) {
      <button type="button" class="hero-nav hero-prev" (click)="prevHeroImage()" aria-label="Previous slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button type="button" class="hero-nav hero-next" (click)="nextHeroImage()" aria-label="Next slide">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <div class="hero-dots">
        @for (img of heroImages(); track $index; let i = $index) {
          <button type="button" class="hero-dot" [class.active]="heroImageIndex() === i" (click)="heroImageIndex.set(i)" [attr.aria-label]="'Slide ' + (i + 1)">
            <span class="hero-dot-progress" [class.running]="heroImageIndex() === i"></span>
          </button>
        }
      </div>
    }
  </div>
  }
  <div class="hero-content">
    <span class="hero-label">{{ 'home.newCollection' | translate }}</span>
    <h1 class="hero-title">{{ getLocalized(hero.title) || ('home.newCollection' | translate) }}</h1>
    @if (getLocalized(hero.subtitle)) {
    <p class="hero-subtitle">{{ getLocalized(hero.subtitle) }}</p>
    }
    @if (hero.ctaUrl && getLocalized(hero.ctaLabel)) {
    <a [routerLink]="hero.ctaUrl" class="btn hero-btn">
      {{ getLocalized(hero.ctaLabel) }}
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </a>
    }
  </div>
  <div class="hero-overlay"></div>
</section>
}

<!-- ═══════ New Arrivals Slider ═══════ -->
<section class="section new-arrivals">
  <div class="container">
    <div class="section-header">
      <div>
        <span class="section-label">{{ 'home.newArrivals' | translate }}</span>
        <h2 class="section-title">{{ 'home.newArrivals' | translate }}</h2>
      </div>
      <a routerLink="/catalog" class="section-link">
        {{ 'nav.shop' | translate }}
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </a>
    </div>
    @if (loading()) {
      <app-loading-skeleton type="card" [count]="4" />
    } @else if (newArrivals().length === 0) {
      <p class="empty-msg">{{ 'catalog.noProducts' | translate }}</p>
    } @else {
      <div class="slider-wrapper">
        <button type="button" class="slider-arrow slider-arrow-left" (click)="scrollSlider(arrivalsTrack, 'left')" aria-label="Scroll left">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <div class="slider-track" #arrivalsTrack>
          @for (p of newArrivals(); track p.id || $index) {
            <div class="slider-item">
              <app-product-card [product]="p" />
            </div>
          }
        </div>
        <button type="button" class="slider-arrow slider-arrow-right" (click)="scrollSlider(arrivalsTrack, 'right')" aria-label="Scroll right">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>
    }
  </div>
</section>

<!-- ═══════ Collections ═══════ -->
@if (collections.length) {
<section class="section collections-section">
  <div class="container">
    <div class="section-header">
      <div>
        <span class="section-label">{{ 'home.collections' | translate }}</span>
        <h2 class="section-title">{{ 'home.collections' | translate }}</h2>
      </div>
    </div>
    <div class="collections-grid">
      @for (col of collections; track col.url || getLocalized(col.title); let i = $index) {
      <a [routerLink]="col.url" class="collection-card">
        @if (col.image) {
        <img [src]="api.imageUrl(col.image)" [alt]="getLocalized(col.title)" loading="lazy" />
        }
        <div class="collection-card-overlay"></div>
        <div class="collection-card-content">
          <span class="collection-label">Collection</span>
          <h3>{{ getLocalized(col.title) }}</h3>
          <span class="collection-cta">
            Shop Now
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
          </span>
        </div>
      </a>
      }
    </div>
  </div>
</section>
}

<!-- ═══════ Our Collection Media ═══════ -->
@if (s?.ourCollectionSectionImages?.length || s?.ourCollectionSectionVideos?.length) {
<section class="section our-collection">
  <div class="container">
    <div class="section-header">
      <div>
        <span class="section-label">{{ 'home.ourCollection' | translate }}</span>
        <h2 class="section-title">{{ 'home.ourCollection' | translate }}</h2>
      </div>
    </div>
    <div class="media-grid">
      @for (img of s?.ourCollectionSectionImages ?? []; track img; let i = $index) {
      <div class="media-item">
        <img [src]="api.imageUrl(img)" alt="" loading="lazy" />
      </div>
      }
      @for (vid of s?.ourCollectionSectionVideos ?? []; track vid) {
      <div class="media-item">
        <video [src]="api.imageUrl(vid)" muted loop playsinline autoplay></video>
      </div>
      }
    </div>
  </div>
</section>
}

<!-- ═══════ Testimonials Slider ═══════ -->
@if (feedbacks.length) {
<section class="section testimonials">
  <div class="container">
    <div class="section-header">
      <div>
        <span class="section-label">{{ 'home.testimonials' | translate }}</span>
        <h2 class="section-title">{{ 'home.testimonials' | translate }}</h2>
      </div>
    </div>
    <div class="slider-wrapper testimonials-slider">
      <button type="button" class="slider-arrow slider-arrow-left" (click)="scrollSlider(testimonialsTrack, 'left')" aria-label="Scroll left">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <div class="slider-track testimonials-track" #testimonialsTrack>
        @for (f of feedbacks; track f.id) {
        <div class="slider-item testimonial-slide">
          <blockquote class="testimonial-card">
            <div class="testimonial-quote-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" opacity="0.1">
                <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
              </svg>
            </div>
            @if (f.rating) {
              <app-star-rating [rating]="f.rating" />
            }
            @if (f.comment) {
            <p class="testimonial-text">{{ f.comment }}</p>
            }
            <div class="testimonial-footer">
              @if (f.customerName) {
              <span class="testimonial-author">{{ f.customerName }}</span>
              }
              @if (f.product?.name) {
              <cite class="testimonial-product">{{ getLocalized(f.product?.name) }}</cite>
              }
            </div>
          </blockquote>
        </div>
        }
      </div>
      <button type="button" class="slider-arrow slider-arrow-right" (click)="scrollSlider(testimonialsTrack, 'right')" aria-label="Scroll right">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>
  </div>
</section>
}
