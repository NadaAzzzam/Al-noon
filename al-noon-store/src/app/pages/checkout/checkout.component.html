<!-- ═══ Shopify-style Checkout Header ═══ -->
<header class="checkout-header">
  <div class="checkout-header-inner">
    <a [routerLink]="['/']" class="checkout-logo">
      @if (checkoutHeaderInfo()?.logo) {
      <img [src]="api.imageUrl(checkoutHeaderInfo()!.logo!)" [alt]="checkoutHeaderInfo()!.storeName?.en || 'Store'" class="checkout-logo-img" />
      } @else {
      <span class="checkout-logo-text">{{ getLocalized(checkoutHeaderInfo()?.storeName) || 'Al-Noon' }}</span>
      }
    </a>
    <a [routerLink]="['/cart']" class="checkout-header-cart" aria-label="Cart">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
        stroke-linecap="round">
        <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
        <line x1="3" y1="6" x2="21" y2="6" />
        <path d="M16 10a4 4 0 0 1-8 0" />
      </svg>
    </a>
  </div>
</header>

@if (items().length === 0) {
<div class="checkout-empty">
  <p>{{ 'checkout.cartEmpty' | translate }}</p>
  <a [routerLink]="['/cart']" class="btn">{{ 'checkout.viewCart' | translate }}</a>
</div>
} @else {
<div class="checkout-wrapper">
  <!-- ═══ Left Column: Form (white) ═══ -->
  <div class="checkout-left">
    <div class="checkout-form-inner">
      <form (ngSubmit)="submit()" class="checkout-form" autocomplete="on">

        <!-- Complete order (top) -->
        <button type="submit" class="checkout-submit-btn checkout-submit-btn-top" [disabled]="submitting()">
          {{ submitting() ? 'Completing order...' : 'Complete order' }}
        </button>

        <!-- Contact / Email -->
        <section class="checkout-section">
          <div class="section-header">
            <h2 class="section-title">Contact</h2>
            @if (!isLoggedIn()) {
            <a [routerLink]="['/account', 'login']" class="section-action-link">Sign in</a>
            }
          </div>
          <div class="form-group">
            <input id="ck-email" type="email" autocomplete="email" [value]="email()"
              (input)="email.set($any($event.target).value)" placeholder="Email" [class.has-error]="emailErrorMsg()" />
            @if (emailErrorMsg()) {
            <span class="field-error">{{ emailErrorMsg() }}</span>
            }
          </div>
          @if (newsletterEnabled()) {
          <label class="checkbox-label">
            <input type="checkbox" [checked]="emailNews()" (change)="emailNews.set($any($event.target).checked)" />
            Email me with news and offers
          </label>
          }
        </section>

        <!-- Delivery -->
        <section class="checkout-section">
          <h2 class="section-title">Delivery</h2>

          <div class="form-group">
            <label for="ck-country" class="floating-label">Country/Region</label>
            <select id="ck-country" disabled>
              <option value="EG" selected>Egypt</option>
            </select>
          </div>

          <div class="form-row form-row-2">
            <div class="form-group">
              <input id="ck-first" type="text" autocomplete="given-name" [value]="firstName()"
                (input)="firstName.set($any($event.target).value)" placeholder="First name"
                [class.has-error]="firstNameError()" />
              @if (firstNameError()) {
              <span class="field-error">{{ firstNameError() }}</span>
              }
            </div>
            <div class="form-group">
              <input id="ck-last" type="text" autocomplete="family-name" [value]="lastName()"
                (input)="lastName.set($any($event.target).value)" placeholder="Last name"
                [class.has-error]="lastNameError()" />
              @if (lastNameError()) {
              <span class="field-error">{{ lastNameError() }}</span>
              }
            </div>
          </div>

          <div class="form-group">
            <input type="text" autocomplete="organization" placeholder="Company (optional)" />
          </div>

          <div class="form-group">
            <input id="ck-address" type="text" autocomplete="street-address" [value]="address()"
              (input)="address.set($any($event.target).value)" placeholder="Address"
              [class.has-error]="addressError()" />
            @if (addressError()) {
            <span class="field-error">{{ addressError() }}</span>
            }
          </div>

          <div class="form-group">
            <input id="ck-apt" type="text" autocomplete="address-line2" [value]="apartment()"
              (input)="apartment.set($any($event.target).value)" placeholder="Apartment, suite, etc. (optional)" />
          </div>

          <div class="form-row form-row-2">
            <div class="form-group">
              <label class="floating-label">City</label>
              <select [value]="selectedCityId()" (change)="selectedCityId.set($any($event.target).value)"
                [class.has-error]="cityError()">
                <option value="">Select city</option>
                @for (c of cities(); track c.id) {
                <option [value]="c.id">{{ getLocalized(c.name) }} — {{ currencySymbol() }} {{ c.deliveryFee | number:'1.2-2' }} {{ currencyCode() }}</option>
                }
              </select>
              @if (cityError()) {
              <span class="field-error">{{ cityError() }}</span>
              }
            </div>
            <div class="form-group">
              <input type="text" autocomplete="postal-code" [value]="postalCode()"
                (input)="postalCode.set($any($event.target).value)" placeholder="Postal code (optional)" />
            </div>
          </div>

          <div class="form-group">
            <input type="tel" autocomplete="tel" [value]="phone()" (input)="phone.set($any($event.target).value)"
              placeholder="Phone" [class.has-error]="phoneError()" />
            @if (phoneError()) {
            <span class="field-error">{{ phoneError() }}</span>
            }
          </div>

          <label class="checkbox-label">
            <input type="checkbox" />
            Save this information for next time
          </label>
          @if (newsletterEnabled()) {
          <label class="checkbox-label">
            <input type="checkbox" [checked]="textNews()" (change)="textNews.set($any($event.target).checked)" />
            Text me with news and offers
          </label>
          }
        </section>

        <!-- Shipping method (from GET /api/shipping-methods list) -->
        <section class="checkout-section">
          <h2 class="section-title">Shipping method</h2>
          <div class="shipping-options">
            @if (shippingMethodsLoading()) {
            <p class="shipping-loading">Loading shipping options…</p>
            } @else if (shippingMethods().length === 0) {
            <p class="shipping-empty">No shipping methods available.</p>
            } @else {
            @for (method of shippingMethods(); track method.id) {
            <div class="shipping-option" [class.selected]="selectedShippingMethod() === method.id"
              (click)="selectedShippingMethod.set(method.id)">
              <div class="shipping-option-left">
                <span class="radio-dot" [class.active]="selectedShippingMethod() === method.id"></span>
                <div class="shipping-option-details">
                  <span class="shipping-name">{{ getLocalized(method.name) }}</span>
                  <span class="shipping-est">{{ getLocalized(method.description) }}</span>
                </div>
              </div>
              <span class="shipping-price">{{ currencySymbol() }} {{ (method.price != null ? method.price : cityDeliveryFee()) | number:'1.2-2' }} {{ currencyCode() }}</span>
            </div>
            }
            }
          </div>
        </section>

        <!-- Payment (from GET /api/payment-methods) -->
        <section class="checkout-section">
          <h2 class="section-title">Payment</h2>
          <p class="section-subtitle">All transactions are secure and encrypted.</p>
          <div class="payment-options">
            @if (paymentMethodsLoading()) {
            <p class="payment-loading">Loading payment options…</p>
            } @else if (paymentMethods().length === 0) {
            <p class="payment-empty">No payment methods available.</p>
            } @else {
            @for (method of paymentMethods(); track method.id) {
            <div class="payment-option" [class.selected]="paymentMethod() === method.id">
              <label class="radio-label">
                <input type="radio" name="payment" [value]="method.id" [checked]="paymentMethod() === method.id"
                  (change)="paymentMethod.set(method.id)" />
                {{ getLocalized(method.name) }}
              </label>
            </div>
            }
            @if (selectedPaymentMethod(); as method) {
            @if (method.id === 'INSTAPAY' && method.instaPayNumber) {
            <p class="instapay-number">Transfer to: <strong>{{ method.instaPayNumber }}</strong></p>
            }
            }
            }
          </div>
        </section>

        <!-- Billing address -->
        <section class="checkout-section">
          <h2 class="section-title">Billing address</h2>
          <div class="billing-options">
            <label class="radio-label billing-radio" [class.selected]="billingSameAsShipping()">
              <input type="radio" name="billing" [checked]="billingSameAsShipping()"
                (change)="billingSameAsShipping.set(true)" />
              Same as shipping address
            </label>
            <label class="radio-label billing-radio" [class.selected]="!billingSameAsShipping()">
              <input type="radio" name="billing" [checked]="!billingSameAsShipping()"
                (change)="billingSameAsShipping.set(false)" />
              Use a different billing address
            </label>
          </div>

          @if (!billingSameAsShipping()) {
          <div class="billing-form">
            <div class="form-row form-row-2">
              <div class="form-group">
                <input type="text" [value]="billingFirstName()"
                  (input)="billingFirstName.set($any($event.target).value)" placeholder="First name" />
              </div>
              <div class="form-group">
                <input type="text" [value]="billingLastName()" (input)="billingLastName.set($any($event.target).value)"
                  placeholder="Last name" />
              </div>
            </div>
            <div class="form-group">
              <input type="text" [value]="billingAddress()" (input)="billingAddress.set($any($event.target).value)"
                placeholder="Address" />
            </div>
            <div class="form-group">
              <input type="text" [value]="billingApartment()" (input)="billingApartment.set($any($event.target).value)"
                placeholder="Apartment, suite, etc. (optional)" />
            </div>
            <div class="form-row form-row-3">
              <div class="form-group">
                <input type="text" [value]="billingCity()" (input)="billingCity.set($any($event.target).value)"
                  placeholder="City" />
              </div>
              <div class="form-group">
                <input type="text" [value]="billingGovernorate()" (input)="billingGovernorate.set($any($event.target).value)"
                  placeholder="Governorate / Region" />
              </div>
              <div class="form-group">
                <input type="text" [value]="billingPostalCode()"
                  (input)="billingPostalCode.set($any($event.target).value)" placeholder="Postal code (optional)" />
              </div>
            </div>
            <div class="form-group">
              <input type="tel" [value]="billingPhone()" (input)="billingPhone.set($any($event.target).value)"
                placeholder="Phone" />
            </div>
          </div>
          }
        </section>

        <!-- Error + Submit -->
        @if (error()) {
        <p class="error-msg">{{ error() }}</p>
        }

        <button type="submit" class="checkout-submit-btn" [disabled]="submitting()">
          {{ submitting() ? 'Completing order...' : 'Complete order' }}
        </button>

      </form>
    </div>
  </div>

  <!-- ═══ Right Column: Order Summary (transparent/light bg) ═══ -->
  <div class="checkout-right">
    <div class="order-summary">
      <!-- Product items -->
      <div class="summary-products">
        @for (item of items(); track (item.productId + (item.variant ?? ''))) {
        <div class="summary-product">
          <div class="summary-product-image">
            @if (item.image) {
            <img [src]="api.imageUrl(item.image)" [alt]="item.name ?? ''" loading="lazy" />
            }
            <span class="summary-product-qty">{{ item.quantity }}</span>
          </div>
          <div class="summary-product-info">
            <span class="summary-product-name">{{ item.name ?? 'Product' }}</span>
            @if (item.variant) {
            <span class="summary-product-variant">{{ item.variant }}</span>
            }
          </div>
          <span class="summary-product-price">{{ currencySymbol() }} {{ (item.price * item.quantity) | number:'1.2-2' }} {{ currencyCode() }}</span>
        </div>
        }
      </div>

      <!-- Discount code -->
      <div class="summary-discount">
        <input type="text" placeholder="Discount code" class="discount-input" />
        <button type="button" class="discount-btn">Apply</button>
      </div>

      <!-- Subtotal, Shipping, Total -->
      <div class="summary-totals">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>{{ currencySymbol() }} {{ subtotal() | number:'1.2-2' }} {{ currencyCode() }}</span>
        </div>
        <div class="summary-row">
          <span class="shipping-label">
            Shipping
            <svg class="info-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 16v-4" />
              <path d="M12 8h.01" />
            </svg>
          </span>
          <span>{{ currencySymbol() }} {{ deliveryFee() | number:'1.2-2' }} {{ currencyCode() }}</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total</span>
          <span class="summary-total-price">
            <small class="currency-label">{{ currencyCode() }}</small>
            {{ currencySymbol() }} {{ total() | number:'1.2-2' }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
}

<!-- ═══ Shopify-style Checkout Footer (links from settings.contentPages) ═══ -->
<footer class="checkout-footer">
  <div class="checkout-footer-inner">
    @if (contentPages().length) {
      @for (page of contentPages(); track page.slug) {
        @if (page.slug === 'contact') {
          <a routerLink="/contact" class="footer-link">{{ getLocalized(page.title) || 'Contact' }}</a>
        } @else {
          <a [routerLink]="['/page', page.slug]" class="footer-link">{{ getLocalized(page.title) || page.slug }}</a>
        }
      }
    } @else {
      <a [routerLink]="['/page', 'return-policy']" class="footer-link">Refund policy</a>
      <a [routerLink]="['/page', 'shipping-policy']" class="footer-link">Shipping</a>
      <a [routerLink]="['/page', 'privacy']" class="footer-link">Privacy policy</a>
      <a routerLink="/contact" class="footer-link">Cancellations</a>
    }
  </div>
</footer>